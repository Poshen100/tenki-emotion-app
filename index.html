<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tenki Pro - Neural Sync</title>
    <style>
        /* =========================================
           1. 核心基礎樣式 (v24.3 - 保留不動)
           ========================================= */
        :root {
            --bg-deep: #050510;
            --plasma-cyan: #23F3D4;
            --sunset-orange: #FF9A76;
            --stardust-purple: #9575FF;
            --glass-bg: rgba(20, 20, 35, 0.6);
            --glass-border: rgba(255, 255, 255, 0.08);
            --font-mono: 'Space Mono', monospace;
            --font-serif: 'Playfair Display', serif;
        }

        body {
            background: var(--bg-deep);
            color: white;
            font-family: var(--font-mono);
            overflow: hidden;
            width: 100vw; 
            height: 100vh; /* Fallback */
            height: 100dvh; /* Mobile Fix */
            margin: 0; padding: 0;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        /* 背景層 */
        #universe {
            position: absolute; inset: 0; z-index: 1;
            background: radial-gradient(circle at center, #1a1a2e 0%, #000000 100%);
            transition: opacity 1s ease, filter 1s ease;
        }
        #universe.active-mode {
            /* 進入儀表板後背景微調 */
            background: radial-gradient(circle at 50% 80%, #202040 0%, #050510 100%);
        }

        /* HUD 層 */
        #hud-layer {
            position: absolute; inset: 0; z-index: 10;
            pointer-events: none;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        #hud-layer.hidden-ui { opacity: 0; pointer-events: none; transform: scale(1.1); }

        /* 提示膠囊 */
        #align-hint-capsule {
            position: absolute; bottom: 20%; left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: rgba(20, 20, 25, 0.75);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            padding: 10px 24px; border-radius: 99px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 13px; letter-spacing: 1px; color: rgba(255,255,255,0.7);
            opacity: 0; pointer-events: none;
            transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1);
            z-index: 100;
        }
        #align-hint-capsule.show { opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: auto; }

        /* Fingerprint v24.3 Styles */
        .fingerprint-wrapper {
            position: relative;
            width: 100px; height: 100px;
            display: flex; justify-content: center; align-items: center;
            pointer-events: auto;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .fingerprint-core {
            width: 70px; height: 70px; border-radius: 50%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex; justify-content: center; align-items: center;
            backdrop-filter: blur(8px);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 10;
        }

        .fingerprint-wrapper.active .fingerprint-core {
            transform: scale(1.15);
            background: rgba(149, 117, 255, 0.15);
            border-color: var(--stardust-purple);
            box-shadow: 0 0 30px rgba(149, 117, 255, 0.4);
        }

        .progress-svg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            transform: rotate(-90deg); z-index: 5; pointer-events: none;
        }

        .progress-circle {
            fill: none;
            stroke: var(--plasma-cyan);
            stroke-width: 2.5;
            stroke-linecap: round;
            stroke-dasharray: 289; /* v24.3 Spec */
            stroke-dashoffset: 289;
            transition: stroke-dashoffset 0.05s linear;
            filter: drop-shadow(0 0 4px var(--plasma-cyan));
        }

        .fingerprint-icon {
            width: 32px; height: 32px;
            stroke: rgba(255,255,255,0.7); transition: all 0.3s;
        }
        .fingerprint-wrapper.active .fingerprint-icon {
            stroke: var(--plasma-cyan); transform: scale(1.1);
        }

        /* =========================================
           2. DASHBOARD LAYER (全新設計：結果頁)
           ========================================= */
        #dashboard-layer {
            position: absolute; inset: 0; z-index: 50;
            background: transparent;
            display: flex; flex-direction: column;
            padding: 50px 20px 100px 20px; /* Adjusted padding */
            overflow-y: auto; opacity: 0; pointer-events: none;
            transform: translateY(30px);
            transition: all 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        #dashboard-layer.show { opacity: 1; pointer-events: auto; transform: translateY(0); }

        /* Header */
        .dash-header {
            margin-bottom: 24px; display: flex; justify-content: space-between; align-items: flex-end;
        }
        .dash-title h1 {
            font-family: var(--font-serif); font-size: 32px; margin: 0; line-height: 1;
            background: linear-gradient(to right, #fff, #aaa); -webkit-background-clip: text; color: transparent;
        }
        .dash-title span {
            font-size: 10px; letter-spacing: 2px; color: var(--plasma-cyan); text-transform: uppercase;
        }
        .live-badge {
            font-size: 10px; color: var(--sunset-orange); border: 1px solid rgba(255, 154, 118, 0.3);
            padding: 4px 8px; border-radius: 4px; display: flex; align-items: center; gap: 6px;
        }
        .live-dot { width: 4px; height: 4px; background: var(--sunset-orange); border-radius: 50%; animation: blink 1s infinite; }

        /* Grid System */
        .bento-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 220px 140px auto; 
            gap: 12px;
            width: 100%;
        }
        .col-span-2 { grid-column: span 2; }

        .card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 16px;
            position: relative; overflow: hidden;
            backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
            box-shadow: 0 4px 30px rgba(0,0,0,0.2);
            display: flex; flex-direction: column;
        }

        /* 2.1 Neural Jitter Card (The Filament) */
        .neural-card {
            background: linear-gradient(160deg, rgba(20,20,35,0.6) 0%, rgba(35,243,212,0.05) 100%);
        }
        .card-top {
            display: flex; justify-content: space-between; align-items: flex-start; z-index: 2;
        }
        .metric-label { font-size: 10px; letter-spacing: 1px; color: rgba(255,255,255,0.5); text-transform: uppercase; }
        .metric-value { 
            font-size: 36px; font-weight: 500; color: white; line-height: 1; margin-top: 4px; 
            font-family: var(--font-mono);
        }
        .metric-unit { font-size: 12px; color: rgba(255,255,255,0.4); margin-left: 2px; }
        
        .neural-status {
            font-size: 11px; padding: 4px 10px; border-radius: 20px;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            color: var(--plasma-cyan); margin-top: 8px; display: inline-block;
        }

        #neural-canvas {
            position: absolute; left: 0; right: 0; bottom: 0; top: 30%;
            width: 100%; height: 70%; z-index: 1;
            /* Fade out edges */
            mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
            -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
        }

        /* 2.2 HRV Gyroscope */
        .gyro-container {
            flex: 1; display: flex; justify-content: center; align-items: center; position: relative;
        }
        .gyro-ring {
            position: absolute; border-radius: 50%; border: 1px solid rgba(255,255,255,0.1);
        }
        .gyro-1 { width: 80px; height: 80px; border-top-color: var(--stardust-purple); animation: spin 4s linear infinite; }
        .gyro-2 { width: 60px; height: 60px; border-bottom-color: var(--plasma-cyan); animation: spin 6s linear infinite reverse; }
        .gyro-dot {
            width: 6px; height: 6px; background: white; border-radius: 50%;
            box-shadow: 0 0 10px white;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* 2.3 Stress Heatmap */
        .heat-container {
            flex: 1; display: flex; flex-direction: column; justify-content: flex-end; padding-bottom: 5px;
        }
        .heat-bar-bg {
            width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; position: relative;
        }
        .heat-bar-fill {
            position: absolute; top: 0; left: 0; height: 100%; width: 100%;
            background: linear-gradient(90deg, #23F3D4, #9575FF, #FF9A76);
            border-radius: 3px; opacity: 0.9;
            /* JS will control mask to simulate fill */
            mask-image: linear-gradient(to right, black 35%, transparent 35%);
            -webkit-mask-image: linear-gradient(to right, black 35%, transparent 35%);
            transition: mask-image 0.5s ease, -webkit-mask-image 0.5s ease;
        }
        .heat-knob {
            position: absolute; top: -4px; width: 2px; height: 14px; background: white;
            box-shadow: 0 0 8px white; left: 35%;
            transition: left 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        /* 2.4 AI Terminal */
        .ai-card {
            border-top: 1px solid var(--stardust-purple);
            background: linear-gradient(180deg, rgba(149, 117, 255, 0.05) 0%, rgba(20,20,35,0.6) 100%);
            padding: 20px;
        }
        .ai-content {
            font-family: 'Space Mono', monospace; font-size: 12px; line-height: 1.6;
            color: rgba(255,255,255,0.85);
            height: 100%; display: flex; align-items: center;
        }
        .cursor { display: inline-block; width: 6px; height: 14px; background: var(--plasma-cyan); margin-left: 4px; animation: blink 0.8s infinite; vertical-align: middle; }

        @keyframes blink { 50% { opacity: 0; } }

        /* Dock */
        .dock-container {
            position: fixed; 
            bottom: calc(30px + env(safe-area-inset-bottom));
            left: 20px; right: 20px; height: 64px;
            background: rgba(10, 10, 20, 0.85); backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.15); border-radius: 32px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            transform: translateY(150px);
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 100;
        }
        .dock-container.show { transform: translateY(0); }
        .dock-action {
            width: 100%; height: 100%; border-radius: 32px;
            display: flex; align-items: center; justify-content: center;
            font-size: 14px; font-weight: 700; letter-spacing: 2px;
            background: linear-gradient(90deg, rgba(35, 243, 212, 0.1), rgba(149, 117, 255, 0.1));
            color: var(--plasma-cyan);
            border: 1px solid rgba(35, 243, 212, 0.2);
        }

    </style>
</head>
<body>

    <!-- 1. 背景層 -->
    <div id="universe"></div>

    <!-- 2. HUD 掃描層 (v24.3 樣式與結構完全保留) -->
    <div id="hud-layer">
        <div class="fingerprint-wrapper" id="fingerprint-btn">
            <svg class="progress-svg">
                <!-- 尺寸根據 v24.3 設定 -->
                <circle class="progress-circle" cx="50" cy="50" r="46"></circle>
            </svg>
            <div class="fingerprint-core">
                <svg class="fingerprint-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 1a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2 2 2 0 0 0 2-2V3a2 2 0 0 0-2-2z"/>
                    <path d="M12 7v10"/>
                    <path d="M8 11v6"/>
                    <path d="M16 11v6"/>
                    <path d="M8 17h8"/>
                    <path d="M12 21v2"/>
                </svg>
            </div>
        </div>
        <div id="align-hint-capsule">按住開始神經連結</div>
    </div>

    <!-- 3. DASHBOARD 數據層 (全新優化版) -->
    <div id="dashboard-layer">
        
        <div class="dash-header">
            <div class="dash-title">
                <span>Subject: User_01</span>
                <h1>Neural Sync</h1>
            </div>
            <div class="live-badge">
                <div class="live-dot"></div> LIVE
            </div>
        </div>

        <div class="bento-grid">
            
            <!-- Neural Jitter Card: The Living Filament -->
            <div class="card neural-card col-span-2">
                <div class="card-top">
                    <div>
                        <div class="metric-label">Neural Jitter</div>
                        <div class="metric-value"><span id="jitter-val">42</span><span class="metric-unit">ms</span></div>
                    </div>
                    <div class="neural-status" id="jitter-status">Coherent Flow</div>
                </div>
                <!-- 呼吸感神經弦 Canvas -->
                <canvas id="neural-canvas"></canvas>
            </div>

            <!-- HRV Gyroscope: Twin-Star Orbit -->
            <div class="card">
                <div class="metric-label">HRV Stability</div>
                <div class="gyro-container">
                    <div class="gyro-ring gyro-1"></div>
                    <div class="gyro-ring gyro-2"></div>
                    <div class="gyro-dot"></div>
                </div>
                <div style="text-align: center; font-size: 18px; font-weight: bold; margin-bottom: 5px; font-family: var(--font-mono);">94<span style="font-size:10px; opacity:0.6;">%</span></div>
            </div>

            <!-- Stress Heatmap: Gradient Slider -->
            <div class="card">
                <div class="metric-label">Stress Zone</div>
                <div class="heat-container">
                    <div style="font-size: 14px; margin-bottom: 10px; color: var(--plasma-cyan); font-family: var(--font-mono);">Eustress</div>
                    <div class="heat-bar-bg">
                        <!-- 利用 CSS Mask 做的動態進度條 -->
                        <div class="heat-bar-fill" id="stress-fill"></div>
                        <div class="heat-knob" id="stress-knob"></div>
                    </div>
                </div>
            </div>

            <!-- AI Insight Terminal: Typewriter -->
            <div class="card ai-card col-span-2">
                <div class="metric-label" style="color:var(--stardust-purple); margin-bottom:8px;">> AI Insight Protocol</div>
                <div class="ai-content">
                    <span id="ai-text"></span><span class="cursor"></span>
                </div>
            </div>

        </div>
    </div>

    <!-- 4. DOCK -->
    <div class="dock-container" id="dock">
        <div class="dock-action">ACCESS DEEP DIVE</div>
    </div>

    <script>
        // ==========================================
        // 1. 核心邏輯：指紋與轉場 (v24.3 邏輯完全保留)
        // ==========================================
        const fingerprintBtn = document.getElementById('fingerprint-btn');
        const progressCircle = document.querySelector('.progress-circle');
        const hudLayer = document.getElementById('hud-layer');
        const dashboardLayer = document.getElementById('dashboard-layer');
        const universe = document.getElementById('universe');
        const hintCapsule = document.getElementById('align-hint-capsule');
        const dock = document.getElementById('dock');
        
        let isScanning = false;
        
        // 初始顯示提示
        setTimeout(() => hintCapsule.classList.add('show'), 1000);

        // 事件監聽
        fingerprintBtn.addEventListener('touchstart', startScan, {passive: false});
        fingerprintBtn.addEventListener('mousedown', startScan);
        fingerprintBtn.addEventListener('touchend', stopScan);
        fingerprintBtn.addEventListener('mouseup', stopScan);
        fingerprintBtn.addEventListener('mouseleave', stopScan);

        function startScan(e) {
            e.preventDefault();
            if (isScanning) return;
            isScanning = true;
            hintCapsule.classList.remove('show');
            fingerprintBtn.classList.add('active');
            
            // v24.3 Spec: dasharray 289
            let dashOffset = 289;
            const step = 289 / 60; // 約1秒滿

            const animateScan = () => {
                if (!isScanning) return;
                dashOffset -= step;
                progressCircle.style.strokeDashoffset = Math.max(0, dashOffset);

                if (dashOffset > 0) {
                    requestAnimationFrame(animateScan);
                } else {
                    completeScan();
                }
            };
            requestAnimationFrame(animateScan);
        }

        function stopScan() {
            if (!isScanning) return;
            isScanning = false;
            fingerprintBtn.classList.remove('active');
            progressCircle.style.strokeDashoffset = 289; // Reset to 289
            if(hudLayer.style.opacity !== '0') hintCapsule.classList.add('show');
        }

        function completeScan() {
            isScanning = false;
            
            // UI 轉場
            hudLayer.classList.add('hidden-ui');
            universe.classList.add('active-mode');
            
            setTimeout(() => {
                dashboardLayer.classList.add('show');
                dock.classList.add('show');
                
                // 啟動 Dashboard 專屬功能 (結果頁邏輯)
                initNeuralFilament(); 
                startDataSimulation();
                typeWriter("偵測到呼吸性竇性心律 (RSA) 耦合。神經震顫指數穩定。建議：維持當前 ALPHA 波段。");
            }, 600);
        }


        // ==========================================
        // 2. DASHBOARD 優化邏輯 (結果頁動態)
        // ==========================================

        // --- A. Neural Filament Canvas (呼吸感電漿弦) ---
        function initNeuralFilament() {
            const canvas = document.getElementById('neural-canvas');
            const ctx = canvas.getContext('2d');
            
            // 設定高解析度 Canvas
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            
            let time = 0;
            let breathCycle = 0; // 模擬呼吸週期

            function render() {
                ctx.clearRect(0, 0, rect.width, rect.height);
                
                // 模擬呼吸週期 (約 5-6秒一圈)
                breathCycle += 0.015;
                // breathVal: -1 (吐氣極值) 到 1 (吸氣極值)
                const breathVal = Math.sin(breathCycle); 
                const isInhale = breathVal > 0;

                // 根據呼吸改變：
                // 吸氣(Inhale): 紫色光暈, 振幅較大 (SNS活躍)
                // 呼氣(Exhale): 青色光暈, 振幅平穩 (PNS活躍)
                const tension = isInhale ? 1.4 : 0.7; // 線條張力
                
                // 顏色計算 (插值)
                // Cyan: 35, 243, 212 | Purple: 149, 117, 255
                // 簡單做兩個顏色的切換
                const r = isInhale ? 149 : 35;
                const g = isInhale ? 117 : 243;
                const b = isInhale ? 255 : 212;
                
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                ctx.shadowBlur = isInhale ? 15 : 6;
                ctx.shadowColor = `rgba(${r},${g},${b},0.6)`;
                ctx.strokeStyle = `rgba(${r},${g},${b},0.8)`;

                ctx.beginPath();
                
                const centerY = rect.height / 2 + 10;
                const width = rect.width;
                
                for (let x = 0; x < width; x += 2) {
                    // 主波形：多重正弦波疊加
                    // 1. 基礎長波 (隨呼吸起伏)
                    let y = centerY + Math.sin(x * 0.01 + time) * (15 * tension);
                    
                    // 2. 雜訊波 (Neural Jitter) - 移動較快
                    y += Math.sin(x * 0.04 - time * 2) * (5 * tension);
                    
                    // 3. 隨機微顫 (生物電訊號質感)
                    y += (Math.random() - 0.5) * (isInhale ? 3 : 1.5);

                    if (x === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();

                time += 0.08; // 波形流動速度
                requestAnimationFrame(render);
            }
            render();
        }

        // --- B. 數據模擬 (Jitter 數值 & Stress Bar) ---
        function startDataSimulation() {
            // 1. Jitter Value: 隨呼吸起伏
            const jitterValEl = document.getElementById('jitter-val');
            const jitterStatusEl = document.getElementById('jitter-status');
            
            setInterval(() => {
                const base = 42;
                // 隨機抖動 +/- 3
                const noise = Math.floor(Math.random() * 6 - 3);
                jitterValEl.innerText = base + noise;
                
                // 偶爾切換狀態文字
                if(Math.random() > 0.8) {
                    jitterStatusEl.innerText = "Resonant Flow";
                    jitterStatusEl.style.color = "var(--plasma-cyan)";
                    jitterStatusEl.style.borderColor = "rgba(35, 243, 212, 0.3)";
                } else if (Math.random() < 0.2) {
                     jitterStatusEl.innerText = "Signal Syncing...";
                     jitterStatusEl.style.color = "rgba(255,255,255,0.7)";
                     jitterStatusEl.style.borderColor = "rgba(255, 255, 255, 0.1)";
                }
            }, 800);

            // 2. Stress Bar: 緩慢游動
            const fill = document.getElementById('stress-fill');
            const knob = document.getElementById('stress-knob');
            
            let stressPct = 35;
            setInterval(() => {
                // 模擬緩慢游走
                stressPct += (Math.random() - 0.5) * 8;
                // 限制範圍
                if(stressPct < 25) stressPct = 25;
                if(stressPct > 55) stressPct = 55;
                
                // 更新 CSS mask 與 Knob 位置
                const maskStyle = `linear-gradient(to right, black ${stressPct}%, transparent ${stressPct}%)`;
                fill.style.webkitMaskImage = maskStyle;
                fill.style.maskImage = maskStyle;
                knob.style.left = `${stressPct}%`;
            }, 1500);
        }

        // --- C. AI 打字機效果 ---
        function typeWriter(txt) {
            const el = document.getElementById('ai-text');
            let i = 0;
            el.innerHTML = "";
            function type() {
                if (i < txt.length) {
                    el.innerHTML += txt.charAt(i);
                    i++;
                    setTimeout(type, 35); // 打字速度
                }
            }
            type();
        }

    </script>
</body>
</html>
